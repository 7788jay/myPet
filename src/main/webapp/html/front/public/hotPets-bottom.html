<div class="col-md-12 col-sm-12" ms-controller="hotPets" id="hotPets">
    <h2>热销商品</h2>
    <div class="owl-carousel owl-carousel4">
        <div ms-repeat="hotPets">
            <div class="product-item">
                <div class="pi-img-wrapper">
                    <img ms-attr-src="el.image" class="img-responsive" ms-attr-alt="el.name" style="height: 280px;"/>
                    <div>
                        <a ms-attr-href="el.image" class="btn btn-default fancybox-button">查看</a>
                    </div>
                </div>
                <h3><a ms-attr-href="item.html?code={{el.code}}">{{el.name}}</a></h3>
                <div class="pi-price">￥{{el.price}}</div>
                <a href="javascript:;" ms-click="addToCart(el.code)" class="btn btn-default add2cart">加入购物车</a>
                <div class="sticker sticker-sale"></div>
            </div>
        </div>
    </div>
</div>

<!--脚本区-->
<script type="text/javascript">
    jQuery(document).ready(function () {
        var hotPets = avalon.define({
            $id: "hotPets",
            hotPets: [],   //销量高
            //初始化
            init: function () {
                //获取最热宠物
                $.ajax({
                    url: "/pet/front/petList/getHotPets",
                    type: "GET",
                    dataType: "json",
                    success: function (result) {
                        result.forEach(function (el) {
                            el.image = el.image.split(",")[0];
                        });
                        hotPets.hotPets = result;
                    }
                });
            },
            //加入购物车
            addToCart: function (code) {
                $.ajax({
                    url: "/pet/front/cart/add?code=" + code,
                    type: "GET",
                    dataType: "json",
                    success: function (result) {
                        if (result.success) {
                            window.location.href = "cart-success.html";
                        }
                    }
                });
            }
        });
        avalon.scan($('#hotPets')[0], hotPets);
        hotPets.init();
    });
</script>