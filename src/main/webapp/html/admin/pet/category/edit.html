<!--样式区-->
<style>
    .ms-controller, .ms-important, [ms-controller], [ms-important] {
        visibility: hidden;
    }
</style>

<!--标签区-->
<div id="editCategory" ms-important="editCategory">
    <div class="form">
        <form id="editForm">
            <input type="hidden" name="code" ms-duplex-number="data.code"/>

            <div class=" user-edit ">
                <div class="remark"> 注：带 * 号为必填项</div>
                <table class="table_1" cellpadding="0" cellspacing="0">
                    <tr>
                        <th width="20%"><span>*</span>种类名称：</th>
                        <td width="30%"><input type="text" name="name" ms-duplex-string="data.name"/></td>
                        <th width="20%"><span>*</span> 所属物种：</th>
                        <td width="30%">
                            <select name="animalCode" ms-duplex-string="data.animalCode">
                                <option ms-repeat="animals" ms-attr-value="el.code">{{el.name}}</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%">描述：</th>
                        <td colspan="3"><textarea name="description" ms-duplex-string="data.description"/></td>
                    </tr>
                </table>
                <div class="user-btn">
                    <input type="button" value="保存" class="oper" ms-click="save"/>
                    <input type="button" value="返回" class="oper" ms-click="back"/>
                </div>
            </div>
        </form>
    </div>
</div>


<!--脚本区-->
<script type="text/javascript">

    $(function () {
        //表单校验
        var validator = $("#editForm").validate({
            rules: {
                name: {required: true, maxlength: 12}
            },
            messages: {
                name: {required: "必填", maxlength: "最大输入11字符长度"}
            },
            errorPlacement: errorPlacement,
            success: "valid"
        });

        var vm = avalon.define({
            $id: "editCategory",
            //先列出绑定属性，保证绑定成功
            animals: [],   //动物种类
            data: {},
            //初始化
            init: function () {
                vm.data.code = PET_ADMIN.getParam("code");
                //获取动物种类
                $.ajax({
                    url: "/admin/pet/animal/queryAll",
                    type: "GET",
                    dataType: 'json',
                    success: function (result) {
                        vm.animals = result;
                    }
                });
                $.ajax({
                    url: "/admin/pet/category/queryOne?code=" + vm.data.code,
                    type: "GET",
                    cache: false,
                    dataType: 'json',
                    beforeSend: function () {
                        PET_ADMIN.openLoading();
                    },
                    complete: function () {
                        PET_ADMIN.closeLoading();
                    },
                    success: function (result) {
                       vm.data = result;
                    }
                })
            },
            //保存
            save: function () {
                if (validator.form()) {
                    $.ajax({
                        url: "/admin/pet/category/update",
                        type: "POST",
                        dataType: 'json',
                        data: $("#editForm").serializeArray(),
                        success: function (result) {
                            if (result.success) {
                                layer.alert("修改成功！");
                                PET_ADMIN.closeDialog();
                            } else {
                                layer.alert("修改失败！"+result.msg);
                            }
                        }
                    });
                }
            },
            back: function () {
                PET_ADMIN.cancelDialog();
            }
        });

        avalon.scan($("#editCategory")[0], vm);
        vm.init();
    })


</script>