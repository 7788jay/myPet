<!--样式区-->
<style>
    .ms-controller, .ms-important {
        visibility: hidden
    }

    input[type='checkbox'] {
        margin: 8px 5px 5px 5px;
    }
</style>

<!--标签区-->
<div id="listOrders" ms-important="listOrders" class="page-content">
    <div class=" search user-c-box">
        <form id="searchCondition">
            <div class="user-c">
                <div class="tj">
                    <span class="search-label">
                        <b>物种名称：</b>
                        <input class="txt" name="name" ms-keydown="enter($event)" type="text" placeholder="请输入"/>
                    </span>
                    <a href="javascript:void(0)" ms-click="query(1)" class=" bt_org">查询</a>
                    <a href="javascript:void(0)" ms-click="clear" class=" bt_org">重置</a>
                </div>
            </div>
        </form>
    </div>
    <!-- 顶部操作-->
    <table class="table_1" cellpadding="0" cellspacing="0">
        <tr>
            <th width="5%"><input type="checkbox" ms-duplex-checked="allChecked"
                                  data-duplex-changed="checkAll"/></th>
            <th width="15%">会员名</th>
            <th width="15%">支付类型</th>
            <th width="15%">配送类型</th>
            <th width="10%">总价</th>
            <th width="10%">订单状态</th>
            <th width="10%">创建时间</th>
            <th width="25%">操作</th>
        </tr>
        <tr ms-repeat="data">
            <td width="5%">
                <input type="checkbox" ms-duplex-checked="el.checked" data-duplex-changed="checkOne" ms-attr-disabled="el.status===0"/>
            </td>
            <td>{{el.userName}}</td>
            <td>{{el.payType}}</td>
            <td>{{el.deliveryType}}</td>
            <td>￥{{el.totalPrice}}</td>
            <td>{{el.status | OrderStatusFilter}}</td>
            <td>{{el.createTime | date}}</td>
            <td>
                <input type="button" value="查看" ms-click="show(pageNo,el.code)"/>
            </td>
        </tr>
    </table>
    <div class="page_num"><a ms-class="disabled:pageNo===1" ms-click="selectPage(-9999)">首页</a> <a
            ms-class="disabled:pageNo===1" ms-click="selectPage(-1)">上页</a> <a
            ms-class="disabled:pageNo===total" ms-click="selectPage(1)">下页</a> <a
            ms-class="disabled:pageNo===total" ms-click="selectPage(9999)">末页</a>
        &emsp;当前第{{pageNo}}页/共{{total}}页，跳转至第
        <input typt="text" id="selectPageNo" ms-blur="toPage" value="1">
        页，每页
        <select id="pageSize" ms-change="selectSize">
            <option>10</option>
            <option>20</option>
            <option>50</option>
            <option>100</option>
        </select>
        条，共<em>{{records}}</em>条记录
    </div>
</div>

<!--脚本区-->
<script type="text/javascript">
    //本页面脚本列表
    var scripts = [null];
    //加载完毕后执行
    ace.load_ajax_scripts(scripts, function () {
        //DOM加载完
        avalon.ready(function () {
            var vm = avalon.define({
                $id: "listOrders",
                allChecked: false, //全选
                condition: [],       //查询条件
                data: [],              //数据
                pageNo: 1,         //页码
                pageSize: 10,    //每页条数
                records: 0,         //总记录
                total: 1,           //总页数
                //回车查询
                enter: function (event) {
                    if (event.keyCode == 13) {
                        vm.query(1);
                    }
                },
                //勾选
                checkOne: function () {
                    if (!this.checked) {
                        vm.allChecked = false;
                    } else {
                        vm.allChecked = vm.data.every(function (el) {
                            return el.checked;
                        });
                    }
                },
                //全选
                checkAll: function () {
                    vm.data.forEach(function (el) {
                        el.checked = vm.allChecked;
                    });
                },
                //查询
                query: function (pageNum) {
                    vm.condition = $("#searchCondition").serializeArray();
                    vm.pageNo = pageNum;
                    vm.queryPage(vm.condition);
                },
                //重置
                clear: function () {
                    $("#searchCondition")[0].reset();
                    vm.condition = $("#searchCondition").serializeArray();
                    vm.pageNo = 1;
                    vm.queryPage(vm.condition);
                },
                //分页查询
                queryPage: function (data) {
                    vm.allChecked = false;
                    $.ajax({
                        url: "/admin/pet/order/queryPage?pageNo=" + vm.pageNo + "&pageSize=" + vm.pageSize,
                        type: "POST",
                        data: data,
                        dataType: "json",
                        beforeSend: function () {
                            PET_ADMIN.openLoading();
                        },
                        complete: function () {
                            PET_ADMIN.closeLoading();
                        },
                        success: function (result) {
                            result.rows.forEach(function (el) {
                                el.checked = false;
                            });
                            vm.data = result.rows;
                            vm.records = result.records;
                            vm.total = result.total;
                        }
                    });
                },
                //首页，上下页，尾页
                selectPage: function (value) {
                    vm.pageNo += parseInt(value);
                    if (vm.pageNo < 1) {
                        vm.pageNo = 1;
                    }
                    if (vm.pageNo > vm.total) {
                        vm.pageNo = vm.total;
                    }
                    vm.queryPage(vm.condition);
                },
                //每页大小
                selectSize: function () {
                    vm.pageSize = parseInt($("#pageSize").val());
                    vm.pageNo = 1;
                    vm.queryPage(vm.condition);
                    $("#pageSize").val(vm.pageSize);
                },
                //跳转到某页
                toPage: function () {
                    var val = $(this).val();
                    if (isNaN(val) || val < 1 || val > vm.total) {
                        layer.alert("请输入正确的页号！");
                        return;
                    }
                    vm.pageNo = parseInt(val);
                    vm.queryPage(vm.condition);
                },
                //查看
                show: function (pageNum, code) {
                    PET_ADMIN.openDialog("/order/edit.html", {code: code}, "查看订单详情", "900px", "470px", function () {
                        vm.query(pageNum);    //重置
                    });
                }
            });
            avalon.scan($("#listOrders")[0], vm);
            vm.query(1);
        });
    });

</script>