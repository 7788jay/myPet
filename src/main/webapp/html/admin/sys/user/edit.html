<!--样式区-->
<style>
    .ms-controller, .ms-important, [ms-controller], [ms-important] {
        visibility: hidden;
    }
</style>

<!--标签区-->
<div id="editTopMenu" ms-important="editTopMenu">
    <div class="form">
        <form id="editForm">
            <input type="hidden" name="id" ms-duplex-number="data.id"/>

            <div class=" user-edit ">
                <div class="remark"> 注：带 * 号为必填项</div>
                <table class="table_1" cellpadding="0" cellspacing="0">
                    <tr>
                        <th width="20%"><span>*</span>菜单名称：</th>
                        <td width="30%"><input type="text" name="name" ms-duplex-string="data.name"/></td>
                        <th width="20%"><span>*</span> 创建时间：</th>
                        <td width="30%">{{data.createDate|date}}</td>
                    </tr>
                    <tr>
                        <th width="20%"><span>*</span> 适用身份：</th>
                        <td colspan="3">
                            <label ms-repeat="userTypeData">
                                <input type="checkbox" ms-attr-value="$key" name="userType"
                                       ms-duplex-number="selected"/>{{$val}} &nbsp;
                            </label>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%"><span>*</span>跳转地址：</th>
                        <td colspan="3">
                            <input type="text" name="url" ms-duplex-string="data.url"/>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%"><span>*</span>排序：</th>
                        <td width="30%" style="border-right: none;">
                            <input type="text" name="priority" ms-duplex-number="data.priority"/>
                        </td>
                        <td colspan="2"></td>
                    </tr>
                    <tr>
                        <th width="20%"><span></span>应用描述：</th>
                        <td colspan="3">
                            <textarea name="description" ms-duplex-string="data.description"/>
                        </td>
                    </tr>
                </table>
                <div class="user-btn">
                    <input type="button" value="保存" class="oper" ms-click="save"/>
                    <input type="button" value="返回" class="oper" ms-click="back"/>
                </div>
            </div>
        </form>
    </div>
</div>


<!--脚本区-->
<script type="text/javascript">

    $(function () {
        //表单校验
        var validator = $("#editForm").validate({
            rules: {
                name: {required: true, maxlength: 12},
                userType: {required: true},
                priority: {required: true, digits: true, max: 999, min: 1},
                url: {required: true, isURL: true}
            },
            messages: {
                name: {required: "必填", maxlength: "最大输入12字符长度"},
                userType: {required: "必选"},
                priority: {required: "必填", digits: "请输入数字", max: "不能大于999", min: "不能小于1"},
                url: {required: "必填"}
            },
            errorPlacement: errorPlacement,
            success: "valid"
        });

        var vm = avalon.define({
            $id: "editTopMenu",
            userTypeData: userTypeMap,
            selected: [],
            //先列出绑定属性，保证绑定成功
            data: {id: null, name: null, url: null, description: null, createDate: null, priority: null},
            //初始化
            init: function () {
                vm.data.id = QKYADMIN.getParam("id");
                avalon.log(vm.userTypeData[1]);
                $.ajax({
                    url: "/admin/qky/app/appMenu/queryOne?id=" + vm.data.id,
                    type: "GET",
                    cache: false,
                    dataType: 'json',
                    beforeSend: function () {
                        QKYADMIN.openLoading();
                    },
                    complete: function () {
                        QKYADMIN.closeLoading();
                    },
                    success: function (result) {
                        if (isSuccess(result)) {
                            vm.data.name = result.bizData.name;
                            vm.data.url = result.bizData.url;
                            vm.data.description = result.bizData.description;
                            vm.data.createDate = result.bizData.createDate;
                            vm.data.priority = result.bizData.priority;
                            vm.selected = getUserTypeInt(result.bizData.userTypes);
                        }
                    }
                })
            },
            //保存
            save: function () {
                if (validator.form()) {
                    $.ajax({
                        url: "/admin/qky/app/appMenu/update",
                        type: "POST",
                        dataType: 'json',
                        data: $("#editForm").serializeArray(),
                        success: function (result) {
                            if (isSuccess(result)) {
                                layer.alert("修改成功！");
                                QKYADMIN.closeDialog();
                            } else {
                                layer.alert("修改失败！"+result.msg);
                            }
                        }
                    });
                }
            },
            back: function () {
                QKYADMIN.cancelDialog();
            }
        });

        avalon.scan($("#editTopMenu")[0], vm);
        vm.init();
    })


</script>