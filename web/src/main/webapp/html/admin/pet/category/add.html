<!--样式区-->
<style>
    .ms-controller, .ms-important, [ms-controller], [ms-important] {
        visibility: hidden;
    }
</style>

<!--标签区-->
<div id="addCategory" ms-important="addCategory">
    <div class="form">
        <form id="addForm">
            <div class=" user-edit ">
                <div class="remark"> 注：带 * 号为必填项</div>
                <table class="table_1" cellpadding="0" cellspacing="0">
                    <tr>
                        <th width="20%"><span>*</span>种类名称：</th>
                        <td width="30%"><input type="text" name="name"/></td>
                        <th width="20%"><span>*</span> 所属物种：</th>
                        <td width="30%">
                            <select name="animalCode">
                                <option ms-repeat="animals" ms-attr-value="el.code">{{el.name}}</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th width="20%"><span>*</span>描述：</th>
                        <td colspan="3"><textarea name="description"/></td>
                    </tr>
                </table>
                <div class="user-btn">
                    <input type="button" value="保存" class="oper" ms-click="save"/>
                    <input type="button" value="返回" class="oper" ms-click="back"/>
                </div>
            </div>
        </form>
    </div>
</div>

<!--脚本区-->
<script type="text/javascript">
    $(function () {
        //表单校验
        var validator = $("#addForm").validate({
            rules: {
                userName: {required: true},
                password: {required: true, isURL: true}
            },
            messages: {
                userName: {required: "必选"},
                password: {required: "必填"}
            },
            errorPlacement: errorPlacement,
            success: "valid"
        });

        var vm = avalon.define({
            $id: "addCategory",
            animals: [],            //物种
            currentDate: new Date(),
            init: function(){
                $.ajax({
                    url: "/admin/pet/animal/queryAll",
                    type: "GET",
                    dataType: 'json',
                    success: function (result) {
                        vm.animals = result;
                    }
                })
            },
            //保存
            save: function () {
                if (validator.form()) {
                    $.ajax({
                        url: "/admin/pet/category/add",
                        type: "POST",
                        dataType: 'json',
                        data: $("#addForm").serializeArray(),
                        success: function (result) {
                            if(result.success){
                                PET_ADMIN.closeDialog();
                            }
                            layer.alert(result.msg);
                        }
                    });
                }
            },
            back: function () {
                PET_ADMIN.cancelDialog();
            }
        });
        avalon.scan($("#addCategory")[0], vm);
        vm.init();
    })
</script>