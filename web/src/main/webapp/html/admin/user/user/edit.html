<!--样式区-->
<style>
    .ms-controller, .ms-important, [ms-controller], [ms-important] {
        visibility: hidden;
    }
</style>

<!--标签区-->
<div id="editUser" ms-important="editUser">
    <div class="form">
        <form id="editForm">
            <input type="hidden" name="id" ms-duplex-number="data.id"/>

            <div class=" user-edit ">
                <div class="remark"> 注：带 * 号为必填项</div>
                <table class="table_1" cellpadding="0" cellspacing="0">
                    <tr>
                        <th width="20%"><span>*</span>用户账号：</th>
                        <td width="30%"><input type="text" name="code" ms-duplex-string="data.code"/></td>
                        <th width="20%"><span>*</span> 创建时间：</th>
                        <td width="30%">{{data.createTime|date}}</td>
                    </tr>
                    <tr>
                        <th width="20%"><span>*</span>用户昵称：</th>
                        <td width="30%"><input type="text" name="userName" ms-duplex-string="data.userName"/></td>
                        <th width="20%"><span>*</span>手机号码：</th>
                        <td width="30%"><input type="text" name="phone" ms-duplex-string="data.phone"/></td>
                    </tr>
                    <tr>
                        <th width="20%"><span>*</span>密码：</th>
                        <td width="30%"><input type="text" name="password" ms-duplex-string="data.password"/></td>
                        <th width="20%"><span>*</span>用户类型：</th>
                        <td width="30%">
                            <select name="userType" ms-duplex-number="data.userType">
                                <option value="0">普通用户</option>
                                <option value="1">管理员</option>
                            </select>
                        </td>
                    </tr>
                </table>
                <div class="user-btn">
                    <input type="button" value="保存" class="oper" ms-click="save"/>
                    <input type="button" value="返回" class="oper" ms-click="back"/>
                </div>
            </div>
        </form>
    </div>
</div>


<!--脚本区-->
<script type="text/javascript">

    $(function () {
        //表单校验
        var validator = $("#editForm").validate({
            rules: {
                code: {required: true, maxlength: 12},
                userName: {required: true},
                password: {required: true, isURL: true}
            },
            messages: {
                code: {required: "必填", maxlength: "最大输入11字符长度"},
                userName: {required: "必选"},
                password: {required: "必填"}
            },
            errorPlacement: errorPlacement,
            success: "valid"
        });

        var vm = avalon.define({
            $id: "editUser",
            //先列出绑定属性，保证绑定成功
            data: {},
            //初始化
            init: function () {
                vm.data.id = PET_ADMIN.getParam("id");
                $.ajax({
                    url: "/admin/user/user/queryOne?id=" + vm.data.id,
                    type: "GET",
                    cache: false,
                    dataType: 'json',
                    beforeSend: function () {
                        PET_ADMIN.openLoading();
                    },
                    complete: function () {
                        PET_ADMIN.closeLoading();
                    },
                    success: function (result) {
                       vm.data = result;
                    }
                })
            },
            //保存
            save: function () {
                if (validator.form()) {
                    $.ajax({
                        url: "/admin/user/user/update",
                        type: "POST",
                        dataType: 'json',
                        data: $("#editForm").serializeArray(),
                        success: function (result) {
                            if (result.success) {
                                layer.alert("修改成功！");
                                PET_ADMIN.closeDialog();
                            } else {
                                layer.alert("修改失败！"+result.msg);
                            }
                        }
                    });
                }
            },
            back: function () {
                PET_ADMIN.cancelDialog();
            }
        });

        avalon.scan($("#editUser")[0], vm);
        vm.init();
    })


</script>