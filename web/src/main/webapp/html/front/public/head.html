<!--样式区-->
<style>
    .ms-controller, .ms-important, [ms-controller], [ms-important] {
        visibility: hidden;
    }
</style>
<div ms-important="public-head" id="public-head">
    <!-- BEGIN STYLE CUSTOMIZER -->
    <div class="color-panel hidden-sm">
        <div class="color-mode-icons icon-color"></div>
        <div class="color-mode-icons icon-color-close"></div>
        <div class="color-mode">
            <p>THEME COLOR</p>
            <ul class="inline">
                <li class="color-red " data-style="red"></li>
                <li class="color-blue" data-style="blue"></li>
                <li class="color-green current color-default" data-style="green"></li>
            </ul>
        </div>
    </div>
    <!-- END BEGIN STYLE CUSTOMIZER -->

    <!-- BEGIN TOP BAR -->
    <div class="pre-header">
        <div class="container">
            <div class="row">
                <!-- BEGIN TOP BAR LEFT PART 头部 -->
                <div class="col-md-6 col-sm-6 additional-shop-info">
                </div>
                <!-- END TOP BAR LEFT PART -->
                <!-- BEGIN TOP BAR MENU -->
                <div class="col-md-6 col-sm-6 additional-nav">
                    <ul class="list-unstyled list-inline pull-right">
                        <li><a href="user.html">{{user.userName}}</a></li>
                        <li><a href="user.html">个人中心</a></li>
                        <li><a href="/logout">注销</a></li>
                        <li ms-if="user == null"><a href="login.html">登陆</a></li>
                        <li ms-if="user.userType"><a href="/html/admin/index.html">进入后台管理</a></li>
                    </ul>
                </div>
                <!-- END TOP BAR MENU -->
            </div>
        </div>
    </div>
    <!-- END TOP BAR -->

    <!-- BEGIN HEADER -->
    <div class="header">
        <div class="container">
            <a class="site-logo" href="index.html">
                <img src="/assets/frontend/layout/img/logos/logo-shop-red.png" alt="MyPet"/>
            </a>
            <a href="javascript:void(0);" class="mobi-toggler"><i class="fa fa-bars"></i></a>

            <!-- BEGIN CART 购物车 -->
            <div class="top-cart-block">
                <div class="top-cart-info">
                    <a href="javascript:void(0);" class="top-cart-info-count">我的购物车</a>
                    <a href="javascript:void(0);" class="top-cart-info-value">￥{{cart.totalPrice}}</a>
                </div>
                <i class="fa fa-shopping-cart"></i>

                <div class="top-cart-content-wrapper">
                    <div class="top-cart-content">
                        <ul class="scroller" style="height: auto;">
                            <li ms-repeat="cart.cartItems">
                                <a ms-attr-href="item.html?code={{$val.pet.code}}"><img ms-attr-src="$val.pet.image.split(',')[0]" width="37" height="34"></a>
                                <span class="cart-content-count">x {{$val.quantity}}</span>
                                <strong><a ms-attr-href="item.html?code={{$val.pet.code}}">{{$val.pet.name}}</a></strong>
                                <em>￥{{$val.pet.price * $val.quantity}}</em>
                                <a href="javascript:void(0);" class="del-goods" ms-click="remove($val.pet.code)">&nbsp;</a>
                            </li>
                        </ul>
                        <div class="text-right">
                            <a href="cart.html" class="btn btn-default">查看购物车</a>
                            <a ms-if="user == null" href="login.html" class="btn btn-primary">登录</a>
                        </div>
                    </div>
                </div>
            </div>
            <!--END CART -->

            <!-- BEGIN 导航栏 -->
            <div class="header-navigation">
                <ul>
                    <li class="dropdown" ms-repeat-an="animals" ms-if-loop="an.categories.length>0">
                        <a class="dropdown-toggle" data-toggle="dropdown" data-target="#" href="javascript:;">
                            {{an.name}}
                        </a>
                        <!-- BEGIN DROPDOWN MENU -->
                        <ul class="dropdown-menu">
                            <li><a ms-repeat-ca="an.categories" ms-attr-href="pet-list.html?code={{ca.code}}">{{ca.name}}</a></li>
                        </ul>
                        <!-- END DROPDOWN MENU -->
                    </li>
                    <li ms-repeat-an="animals" ms-if-loop="an.categories.length==0">
                        <a href="shop-product-list.html">{{an.name}}</a>
                    </li>

                    <!-- BEGIN TOP 搜索 -->
                    <li class="menu-search">
                        <span class="sep"></span>
                        <i class="fa fa-search search-btn"></i>
                        <div class="search-box">
                            <form action="#">
                                <div class="input-group">
                                    <input type="text" id="searchName" placeholder="请输入宠物名" class="form-control">
                                    <span class="input-group-btn">
                                      <button class="btn btn-primary" type="button" ms-click="search">搜索</button>
                                    </span>
                                </div>
                            </form>
                        </div>
                    </li>
                    <!-- END TOP 搜索 -->
                </ul>
            </div>
            <!-- END 导航栏 -->
        </div>
    </div>
    <!-- Header END -->
</div>

<!--脚本区-->
<script type="text/javascript">
    jQuery(document).ready(function () {
        var vm = avalon.define({
            $id: "public-head",
            user: {},  //用户
            cart: {cartItems: {}, totalPrice: null},   //购物车
            animals: [],    //动物种类
            categories: [],  //宠物分类

            //初始化
            init: function () {
                //获取用户信息
                $.ajax({
                    url: "/common/user/getCurrentUser",
                    type: "GET",
                    dataType: "json",
                    success: function (result) {
                        vm.user = result;
                    }
                });
                //购物车信息
                $.ajax({
                    url: "/pet/front/cart/queryCart",
                    type: "GET",
                    dataType: "json",
                    success: function (result) {
                        vm.cart = result;
                    }
                });
                //获取动物分类
                $.ajax({
                    url: "/admin/pet/animal/getAnimalAndCategory",
                    type: "GET",
                    dataType: "json",
                    success: function (result) {
                        vm.animals = result;
                    }
                });
            },
            //移出购物车
            remove: function(code){
                $.ajax({
                    url: "/pet/front/cart/remove?code="+code,
                    type: "GET",
                    dataType: "json",
                    success: function (result) {
                        vm.cart = result;
                    }
                });
            },
            //跳转到搜索
            search: function(){
                var searchName = $('#searchName').val();
                window.location.href = 'pet-search.html?searchName='+encodeURI(encodeURI(searchName));
            }
        });
        avalon.scan($('#public-head')[0],vm);
        vm.init();
    });
</script>